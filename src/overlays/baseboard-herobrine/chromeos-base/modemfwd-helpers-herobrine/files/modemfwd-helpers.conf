# Copyright 2022 The ChromiumOS Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

description     "modemfwd helper"
author          "pholla@chromium.org"

env FW_DIR=/lib/firmware/qcom/sc7280-herobrine/modem

task
# Same oom score level as e.g. shill
oom score -100

import main

pre-start script
  case "${main}" in
    "/opt/google/modemfwd-firmware/modem-latest")
     ;;
    "/opt/google/modemfwd-firmware/modem-24")
     ;;
    "/run/imageloader/modem-fw-dlc-hoglin/package/root/modem-24")
     ;;
    *)
      logger -p err -t "${UPSTART_JOB}" "Unsupported main fw version: ${main}"
      exit 1
      ;;
  esac
end script

script
mount --bind "${main}" "${FW_DIR}"
initctl stop rmtfs || true
initctl start rmtfs
end script
