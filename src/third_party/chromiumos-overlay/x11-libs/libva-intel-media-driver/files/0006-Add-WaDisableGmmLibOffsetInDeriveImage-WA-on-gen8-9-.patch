From d3f3c64677a2e0615f2139cb1053e35c3a0fb1e6 Mon Sep 17 00:00:00 2001
From: Jay Yang <jay.yang@intel.com>
Date: Thu, 1 Jun 2023 13:39:31 +0800
Subject: [PATCH] Add WaDisableGmmLibOffsetInDeriveImage WA on gen8/9/10 to fix
 chromeOS UV shift

---
 media_driver/linux/gen10/ddi/media_sku_wa_g10.cpp | 2 ++
 media_driver/linux/gen8/ddi/media_sku_wa_g8.cpp   | 1 +
 media_driver/linux/gen9/ddi/media_sku_wa_g9.cpp   | 6 ++++++
 3 files changed, 9 insertions(+)

diff --git a/media_driver/linux/gen10/ddi/media_sku_wa_g10.cpp b/media_driver/linux/gen10/ddi/media_sku_wa_g10.cpp
index 6698bd4f4..e18a0dab1 100644
--- a/media_driver/linux/gen10/ddi/media_sku_wa_g10.cpp
+++ b/media_driver/linux/gen10/ddi/media_sku_wa_g10.cpp
@@ -186,6 +186,8 @@ static bool InitCnlMediaWa(struct GfxDeviceInfo *devInfo,
     MEDIA_WR_WA(waTable, Wa16KInputHeightNV12Planar420, 1);
     MEDIA_WR_WA(waTable, WaDisableCodecMmc, 1);
     MEDIA_WR_WA(waTable, WaDisableSetObjectCapture, 0);
+
+    MEDIA_WR_WA(waTable, WaDisableGmmLibOffsetInDeriveImage, 1);
     return true;
 }
 
diff --git a/media_driver/linux/gen8/ddi/media_sku_wa_g8.cpp b/media_driver/linux/gen8/ddi/media_sku_wa_g8.cpp
index ae4da5165..7ac199062 100644
--- a/media_driver/linux/gen8/ddi/media_sku_wa_g8.cpp
+++ b/media_driver/linux/gen8/ddi/media_sku_wa_g8.cpp
@@ -130,6 +130,7 @@ static bool InitBdwMediaWa(struct GfxDeviceInfo *devInfo,
     MEDIA_WR_WA(waTable, Wa16KInputHeightNV12Planar420, 1);
     MEDIA_WR_WA(waTable, WaDisableCodecMmc, 1);
     MEDIA_WR_WA(waTable, WaDisableSetObjectCapture, 0);
+    MEDIA_WR_WA(waTable, WaDisableGmmLibOffsetInDeriveImage, 1);
     return true;
 }
 
diff --git a/media_driver/linux/gen9/ddi/media_sku_wa_g9.cpp b/media_driver/linux/gen9/ddi/media_sku_wa_g9.cpp
index b700b9781..a3297238d 100755
--- a/media_driver/linux/gen9/ddi/media_sku_wa_g9.cpp
+++ b/media_driver/linux/gen9/ddi/media_sku_wa_g9.cpp
@@ -237,6 +237,8 @@ static bool InitSklMediaWa(struct GfxDeviceInfo *devInfo,
     MEDIA_WR_WA(waTable, Wa16KInputHeightNV12Planar420, 1);
     MEDIA_WR_WA(waTable, WaDisableCodecMmc, 1);
     MEDIA_WR_WA(waTable, WaDisableSetObjectCapture, 0);
+
+    MEDIA_WR_WA(waTable, WaDisableGmmLibOffsetInDeriveImage, 1);
     return true;
 }
 
@@ -339,6 +341,8 @@ static bool InitBxtMediaWa(struct GfxDeviceInfo *devInfo,
 
     MEDIA_WR_WA(waTable, Wa16KInputHeightNV12Planar420, 1);
     MEDIA_WR_WA(waTable, WaDisableCodecMmc, 1);
+
+    MEDIA_WR_WA(waTable, WaDisableGmmLibOffsetInDeriveImage, 1);
     return true;
 }
 
@@ -473,6 +477,8 @@ static bool InitKblMediaWa(struct GfxDeviceInfo *devInfo,
 
     MEDIA_WR_WA(waTable, Wa16KInputHeightNV12Planar420, 1);
     MEDIA_WR_WA(waTable, WaDisableCodecMmc, 1);
+
+    MEDIA_WR_WA(waTable, WaDisableGmmLibOffsetInDeriveImage, 1);
     return true;
 }
 
-- 
2.25.1

